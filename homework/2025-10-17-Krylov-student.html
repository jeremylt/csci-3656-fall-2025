<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>2025-10-17 Krylov Subspaces</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="2025-10-03 Orthogonal Polynomials" href="2025-10-03-Orthogonal-Polynomials-student.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>Before you turn this problem in, make sure everything runs as expected. First, restart the kernel (in the menubar, select Kernel → Restart) and then run all cells (in the menubar, select Cell → Run All).</p>
<p>Make sure you fill in any place that says <code class="docutils literal notranslate"><span class="pre">BEGIN</span> <span class="pre">SOLUTION</span></code> and <code class="docutils literal notranslate"><span class="pre">END</span> <span class="pre">SOLUTION</span></code>, as well as your name and collaborators below:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="n">COLLABORATORS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span>
</pre></div>
</div>
</div>
<section id="2025-10-17-Krylov-Subspaces">
<h1>2025-10-17 Krylov Subspaces<a class="headerlink" href="#2025-10-17-Krylov-Subspaces" title="Link to this heading">¶</a></h1>
<p>In class, we discussed computing the <span class="math notranslate nohighlight">\(QR\)</span> factorization of a matrix by applying an orthogonalization process, such as Gram-Schmidt to the columns of a matrix <span class="math notranslate nohighlight">\(A\)</span>. However, this can become impractical if the matrix <span class="math notranslate nohighlight">\(A\)</span> is quite large, such as linear systems of equations representing billions of unknown values in a large scale computational simulation.</p>
<p>There exists a family of iterative methods based upon the <strong>Krylov subspace</strong>. In this assignment, we will look at one of these <strong>Krylov subspace</strong> methods, the <strong>conjugate gradient</strong> method.</p>
<p>Suppose the matrix <span class="math notranslate nohighlight">\(A\)</span> is square. The <a class="reference external" href="https://en.wikipedia.org/wiki/Krylov_subspace">Krylov subspace</a> generated by the <span class="math notranslate nohighlight">\(n \times n\)</span> matrix <span class="math notranslate nohighlight">\(A\)</span> and the vector <span class="math notranslate nohighlight">\(b\)</span> of length <span class="math notranslate nohighlight">\(n\)</span> is defined as the linear subspace of the images of <span class="math notranslate nohighlight">\(b\)</span> under the first <span class="math notranslate nohighlight">\(k + 1\)</span> powers of <span class="math notranslate nohighlight">\(A\)</span>. That is to say,</p>
<div class="math notranslate nohighlight">
\[\mathscr{K}_r \left( A, b \right) = \text{span} \left\lbrace b, A b, A^2 b, \dots, A^k b \right\rbrace\]</div>
<section id="Building-a-Krylov-subspace">
<h2>Building a Krylov subspace<a class="headerlink" href="#Building-a-Krylov-subspace" title="Link to this heading">¶</a></h2>
<p>Let’s start by comparing a Krylov subspace and the columns of a <span class="math notranslate nohighlight">\(QR\)</span> factorization for the Vandermonde matrix.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">LinearAlgebra</span>
<span class="k">using</span><span class="w"> </span><span class="n">Plots</span>
<span class="k">using</span><span class="w"> </span><span class="n">Test</span>

<span class="c"># Here&#39;s our Vandermonde matrix again</span>
<span class="k">function</span><span class="w"> </span><span class="n">vander</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">=</span><span class="nb">nothing</span><span class="p">)</span>
<span class="w">    </span><span class="s">&quot;&quot;&quot;Return a Vandermonde matrix of the first k monomials evaluated at the points x.</span>
<span class="s">    The returned matrix will be of size m x k, where m is the length of the vector x.</span>
<span class="s">    If no k is provided, the returned matrix will be square.</span>
<span class="s">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">isnothing</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="w">        </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="w">    </span><span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="n">k</span>
<span class="w">        </span><span class="n">V</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">x</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">V</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>We’ll use this convenience function for visualizing the difference between the basis formed from the columns of <span class="math notranslate nohighlight">\(A\)</span> with <span class="math notranslate nohighlight">\(QR\)</span> factorization and the Krylov basis we’ll form below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Helper function to plot the columns of a matrix as basis functions</span>

<span class="k">function</span><span class="w"> </span><span class="n">plot_basis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">)</span>
<span class="w">    </span><span class="s">&quot;&quot;&quot;Plot a series of basis vectors stored in the columns of the matrix A</span>
<span class="s">    at the points given by x. The length of x and the number of rows of A</span>
<span class="s">    must be the same.</span>
<span class="s">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="w">    </span><span class="n">plt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\$</span><span class="s">q_0</span><span class="se">\$</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="n">m</span>
<span class="w">        </span><span class="n">plt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plot!</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\$</span><span class="s">q_</span><span class="si">$</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="se">\$</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">display</span><span class="p">(</span><span class="n">plt</span><span class="p">)</span>
<span class="k">end</span>

<span class="c"># Plot the basis vectors from a QR factorization of the Vandermonde matrix</span>
<span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">LinRange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qr</span><span class="p">(</span><span class="n">vander</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">plot_basis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Krylov subspace methods are iterative methods used to solve linear systems of equations <span class="math notranslate nohighlight">\(A x = b\)</span>. For now, we will focus on creating the Krylov subspace of degree <span class="math notranslate nohighlight">\(k\)</span> for the matrix <span class="math notranslate nohighlight">\(A\)</span>.</p>
<p>The Krylov subspace is formed by the vectors</p>
<div class="math notranslate nohighlight">
\[\mathscr{K}_r \left( A, b \right) = \text{span} \left\lbrace b, A b, A^2 b, \dots, A^k b \right\rbrace\]</div>
<p>However, we want an orthonormal basis. We will use <a class="reference external" href="https://en.wikipedia.org/wiki/Gram%E2%80%93Schmidt_process">Gram-Schmidt orthogonalization</a> as part of the <a class="reference external" href="https://en.wikipedia.org/wiki/Arnoldi_iteration">Arnoldi iteration</a> to form this orthonormal basis.</p>
<p>That is to say, we will form the matrices <span class="math notranslate nohighlight">\(Q\)</span> and <span class="math notranslate nohighlight">\(H\)</span> such that</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(Q\)</span> is <span class="math notranslate nohighlight">\(n \times k + 1\)</span> with the orthonormalized columns given by the Gram-Schmidt process on the vectors <span class="math notranslate nohighlight">\(A^i b\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(H\)</span> is the <span class="math notranslate nohighlight">\(k \times k\)</span> <a class="reference external" href="https://en.wikipedia.org/wiki/Hessenberg_matrix">upper Hessenberg</a> matrix holding the factors from the Gram-Schmidt process.</p></li>
</ul>
<p>This definition of <span class="math notranslate nohighlight">\(H\)</span> may seem strange, however it has a powerful application. The matrix <span class="math notranslate nohighlight">\(H\)</span> is constructed so that <span class="math notranslate nohighlight">\(H =  Q^T A Q\)</span>. This means that <span class="math notranslate nohighlight">\(A Q_n = Q_{n + 1} \tilde{H}_n\)</span>, where <span class="math notranslate nohighlight">\(Q_n\)</span> is the orthonormal basis of the Krylov subspace with <span class="math notranslate nohighlight">\(n\)</span> vectors (columns) while <span class="math notranslate nohighlight">\(Q_{n + 1}\)</span> is the basis of the Krylov subspace with <span class="math notranslate nohighlight">\(n + 1\)</span> vectors and <span class="math notranslate nohighlight">\(\tilde{H}_n\)</span> is augmented with an additional row.</p>
<p>Our function will return the matrix <span class="math notranslate nohighlight">\(\tilde{H}\)</span> which is the <span class="math notranslate nohighlight">\(k + 1 \times k\)</span> matrix holding the factors <span class="math notranslate nohighlight">\(\tilde{H}_{i, j-1} = q_i \cdot v\)</span> from the Gram-Schmidt process on and above the diagonal and the norms <span class="math notranslate nohighlight">\(\tilde{H}_{i, i-1} = \lvert \lvert v \rvert \rvert\)</span> on the lower subdiagonal.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">arnoldi</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">=</span><span class="nb">nothing</span><span class="p">)</span>
<span class="w">    </span><span class="s">&quot;&quot;&quot;Form the Krylov subspace from the initial vector b and the matrix A.</span>
<span class="s">    This function returns a pair of matrices Q, H.</span>
<span class="s">    The columns of Q are the orthonormalized basis vectors for the Krylov space.</span>
<span class="s">    H is upper Hessenberg and holds the normalization factors.</span>
<span class="s">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="c"># Get our dimensions for the subspace</span>
<span class="w">    </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">isnothing</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="w">        </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="c"># Build a matrix to hold the subspace and initialize it</span>
<span class="w">    </span><span class="n">Q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Let&#39;s put our factors here, similar to QR</span>
<span class="w">    </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">norm</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">r</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>
<span class="w">        </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">i</span>
<span class="w">            </span><span class="c">### BEGIN SOLUTION]</span>

<span class="w">            </span><span class="c">### END SOLUTION</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">        </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="w">        </span><span class="c"># We need to stop if the norm of v is small</span>
<span class="w">        </span><span class="c">#  This means v ≈ 0</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1e3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">eps</span><span class="p">()</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">        </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">r</span>
<span class="w">        </span><span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span>
<span class="k">end</span>

<span class="c"># And let&#39;s look at what happens</span>
<span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">LinRange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="c"># Need a square matrix</span>
<span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arnoldi</span><span class="p">(</span><span class="n">vander</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="nd">@show</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span>
<span class="nd">@show</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;H =&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">H</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span>
<span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span>
<span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arnoldi</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>

<span class="nd">@test</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="p">]</span><span class="w"> </span><span class="o">≈</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="nd">@test</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Q</span><span class="o">&#39;</span><span class="w"> </span><span class="o">≈</span><span class="w"> </span><span class="n">I</span>
<span class="nd">@test</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">≈</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">H</span>
</pre></div>
</div>
</div>
<p>Let’s plot the basis vectors from our Arnoldi iterations and see how they compare to the basis vectors from the <span class="math notranslate nohighlight">\(QR\)</span> factorization.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Plot the basis vectors from the Arnoldi iterations for a Vandermonde matrix</span>
<span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">LinRange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arnoldi</span><span class="p">(</span><span class="n">vander</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="n">plot_basis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This plot looks significantly different, telling us that we cannot interpret this basis in the same way as we did before. However, we can use the basis from the Arnoldi iteration to solve a linear system of equations <span class="math notranslate nohighlight">\(A x = b\)</span>. We’ll come back to this, but first let’s pick a problem to solve.</p>
<p>We will solve the equation <span class="math notranslate nohighlight">\(A p = y\)</span>, where <span class="math notranslate nohighlight">\(A\)</span> is the Vandermonde matrix at some points <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(p\)</span> represents the polynomial coefficients for the polynomial of degree <span class="math notranslate nohighlight">\(3\)</span> that fits the points <span class="math notranslate nohighlight">\((x_i, y_i)\)</span> given by the vectors <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span>.</p>
<p>First, let’s solve a system of equations with <span class="math notranslate nohighlight">\(QR\)</span> factorization as we did in class. With <span class="math notranslate nohighlight">\(QR\)</span> factorization, we form the orthonormal matrix <span class="math notranslate nohighlight">\(Q\)</span> and the upper triangular matrix <span class="math notranslate nohighlight">\(R\)</span> such that <span class="math notranslate nohighlight">\(A = QR\)</span>. This means that <span class="math notranslate nohighlight">\(Q R p = y\)</span> or <span class="math notranslate nohighlight">\(p = R^{-1} Q^{-1} y_1\)</span>. Since <span class="math notranslate nohighlight">\(Q\)</span> is orthonormal, <span class="math notranslate nohighlight">\(Q^{-1} = Q^T\)</span>. <span class="math notranslate nohighlight">\(R\)</span> is upper triangular and can be solved algorithmically.</p>
<p>Complete the function below to solve a system of equations <span class="math notranslate nohighlight">\(R x = b\)</span>, where <span class="math notranslate nohighlight">\(R\)</span> is a upper triangular matrix.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">solve_upper_triangular</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="s">&quot;&quot;&quot;Solve the linear system of equations R x = b.</span>
<span class="s">    R is upper triangular.</span>
<span class="s">    This function returns the vector x such that R x = b.</span>
<span class="s">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="c"># We&#39;ll store the solution in x</span>
<span class="w">    </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="w">    </span><span class="c"># And solve for each x_i starting with the last row</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">n</span><span class="o">:-</span><span class="mi">1</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="c"># Note the syntax here, how does i increment?</span>
<span class="w">        </span><span class="n">x_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="w">        </span><span class="c"># Solve the equation R_(i, :) * x_i = b_i for the current row</span>
<span class="w">        </span><span class="c">### BEGIN SOLUTION</span>

<span class="w">        </span><span class="c">### END SOLUTION</span>
<span class="w">        </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x_i</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">x</span>
<span class="k">end</span>

<span class="c"># Let&#39;s do a small test</span>
<span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1.</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">     </span><span class="mi">0</span><span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">     </span><span class="mi">0</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="mi">6</span><span class="p">]</span>
<span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1.</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span>
<span class="nd">@show</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solve_upper_triangular</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="nd">@show</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># &#39;normal&#39; test case</span>
<span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1.</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">     </span><span class="mi">0</span><span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>
<span class="w">     </span><span class="mi">0</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<span class="w">     </span><span class="mi">0</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">     </span><span class="mi">0</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span>
<span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1.</span><span class="p">;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="mi">5</span><span class="p">]</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solve_upper_triangular</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="nd">@test</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">≈</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c"># and a trivial test case</span>
<span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1.</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">     </span><span class="mi">0</span><span class="w">  </span><span class="mi">1</span><span class="p">]</span>
<span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1.</span><span class="p">;</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solve_upper_triangular</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="nd">@test</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">≈</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we can your function <code class="docutils literal notranslate"><span class="pre">solve_upper_triangular()</span></code> to solve the linear system of equations <span class="math notranslate nohighlight">\(A p = y_1\)</span> given below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># We want A p = y1</span>
<span class="c"># Note - using x1 and y1 to distinguish from the plotting points x below</span>
<span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mf">0.9</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="w">  </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">]</span>
<span class="n">y1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.4</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="w"> </span><span class="mf">1.3</span><span class="p">]</span>
<span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vander</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>

<span class="c"># Form the basis of A via QR factorization and solve for p</span>
<span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qr</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solve_upper_triangular</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="o">&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y1</span><span class="p">)</span>
<span class="nd">@show</span><span class="w"> </span><span class="n">p_qr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span>

<span class="c"># And plot</span>
<span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
<span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">LinRange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="n">scatter</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;data&quot;</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">vander</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\$</span><span class="s">p = R^{-1} Q^T b</span><span class="se">\$</span><span class="s">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can also use the Krylov subspace from our Arnoldi iteration to solve a linear system of equations <span class="math notranslate nohighlight">\(A x = b\)</span>. There are several Krylov subspace methods that have been developed; however we will use the <a class="reference external" href="https://en.wikipedia.org/wiki/Generalized_minimal_residual_method">Generalized minimal residual method</a> (GMRES).</p>
<p>Given the basis <span class="math notranslate nohighlight">\(Q_n\)</span> from the Arnoldi process, we want to find the coefficients <span class="math notranslate nohighlight">\(c\)</span> to form the nearest vector in the Krylov subspace to the solution, which is the vector <span class="math notranslate nohighlight">\(x_n = x_0 + Q_n c_n\)</span> such that the residual <span class="math notranslate nohighlight">\(\left\lvert \left\lvert r_n \right\rvert \right\rvert = \left\lvert \left\lvert b - A x_n \right\rvert \right\rvert\)</span> is minimized. For simplicity, we will use <span class="math notranslate nohighlight">\(x_0 = 0\)</span>.</p>
<p>Simplifying our expression, we have</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
    \left\lvert \left\lvert r_n \right\rvert \right\rvert
    &amp;= \left\lvert \left\lvert b - A x_n \right\rvert \right\rvert\\
    &amp;= \left\lvert \left\lvert b - A Q_n c_n \right\rvert \right\rvert\\
    &amp;= \left\lvert \left\lvert b - Q_{n + 1} \tilde{H}_n c_n \right\rvert \right\rvert\\
    &amp;= \left\lvert \left\lvert Q_{n + 1} \left( \beta e_1 - \tilde{H}_n c_n \right) \right\rvert \right\rvert\\
\end{align}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\beta = \left\lvert \left\lvert b  \right\rvert \right\rvert\\\)</span> and <span class="math notranslate nohighlight">\(e_1 = \left[ 1, 0, 0, \dots, 0 \right]\)</span>.</p>
<p>We therefore want to find the solution to the least squares problem <span class="math notranslate nohighlight">\(\beta e_1 - \tilde{H}_n c_n = 0\)</span>. We can then use our vector <span class="math notranslate nohighlight">\(c_n\)</span> to form <span class="math notranslate nohighlight">\(x_n = x_0 + Q_n c_n = Q_n c_n\)</span> (because we assumed <span class="math notranslate nohighlight">\(x_0 = 0\)</span>).</p>
<p>Note that we could create a function <code class="docutils literal notranslate"><span class="pre">solve_upper_hessenberg()</span></code>, but we will forgo that detail and focus on using our Krylov subspace. We can use <code class="docutils literal notranslate"><span class="pre">\</span></code> to let Julia solve this system of equations for us.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># We want A p = y1</span>
<span class="c"># Again using x1 and y1 to distinguish x1 from the plotting points x below</span>
<span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mf">0.9</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="w">  </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">]</span>
<span class="n">y1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.4</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="w"> </span><span class="mf">1.3</span><span class="p">]</span>
<span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vander</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>

<span class="c"># Form the Krylov subspace</span>
<span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
<span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arnoldi</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>

<span class="c"># Solve the least squares problem</span>
<span class="n">β</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">norm</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">e1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">e1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="c">### BEGIN SOLUTION</span>

<span class="c">### END SOLUTION</span>
<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span>
<span class="nd">@show</span><span class="w"> </span><span class="n">p_gmres</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span>
<span class="nd">@show</span><span class="w"> </span><span class="n">norm</span><span class="p">(</span><span class="n">p_gmres</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p_qr</span><span class="p">)</span>

<span class="c"># And plot</span>
<span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">LinRange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="n">scatter</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;data&quot;</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">vander</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\$</span><span class="s">p = Q H^{-1} e_1</span><span class="se">\$</span><span class="s">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>It should reassure us greatly that we appear to have reached the same solution.</p>
<p>It may seem like we did a more work to set up a problem that is more difficult to solve than using the <span class="math notranslate nohighlight">\(QR\)</span> factorization. While this may be true for small systems of equations, the true power of Krylov subspace methods is the fact that it they are iterative methods. This offers two important benefits.</p>
<ul class="simple">
<li><p>For large systems of equations (millions or billions of values in the solution vector), we do not need to form the entire full rank Krylov space to achieve a solution <span class="math notranslate nohighlight">\(x_n\)</span> with a low residual <span class="math notranslate nohighlight">\(r_n\)</span>.</p></li>
<li><p>The assembled matrix <span class="math notranslate nohighlight">\(A\)</span> is not required, only the ability to apply the matrix-vector product <span class="math notranslate nohighlight">\(A x\)</span>. This enables <a class="reference external" href="https://en.wikipedia.org/wiki/Matrix-free_methods">matrix-free methods</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/Newton%E2%80%93Krylov_method">Newton-Krylov methods</a>, which are workhorses in large scale computational simulations, such as on supercomputers.</p></li>
</ul>
<p>Let’s implement the ability to expand our Krylov subspace so we can see the benefit of the first point.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">arnoldi_update</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">)</span>
<span class="w">    </span><span class="s">&quot;&quot;&quot;Update the Krylov subspace from the initial vector b and the matrix A.</span>
<span class="s">    This function returns an updated pair of matrices Q, H.</span>
<span class="s">    Q has a new column for the next orthonormal vector and H has the updated factors.</span>
<span class="s">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="c"># Get our dimensions for the subspace</span>
<span class="w">    </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Build a new Q</span>
<span class="w">    </span><span class="c"># This is inefficient but shows the idea</span>
<span class="w">    </span><span class="n">Q_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">Q_new</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span>
<span class="w">    </span><span class="c"># And a new H</span>
<span class="w">    </span><span class="n">H_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="w">    </span><span class="n">H_new</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span>
<span class="w">    </span><span class="c"># Compute new Krylov vector</span>
<span class="w">    </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Q_new</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">]</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">k</span>
<span class="w">        </span><span class="c">### BEGIN SOLUTION]</span>

<span class="w">        </span><span class="c">### END SOLUTION</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="w">    </span><span class="c"># We need to stop if the norm of v is small</span>
<span class="w">    </span><span class="c">#  This means v ≈ 0</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1e3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">eps</span><span class="p">()</span>
<span class="w">        </span><span class="n">Q_new</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">r</span>
<span class="w">        </span><span class="n">H_new</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">Q_new</span><span class="p">,</span><span class="w"> </span><span class="n">H_new</span>
<span class="k">end</span>

<span class="c"># And let&#39;s look at what happens</span>
<span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">LinRange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="c"># Need a square matrix</span>
<span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vander</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="c"># Let&#39;s compare the old</span>
<span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arnoldi</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;arnoldi(A, b, 4)&quot;</span><span class="p">)</span>
<span class="nd">@show</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;H =&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">H</span><span class="p">);</span>

<span class="c"># With the new</span>
<span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arnoldi</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arnoldi_update</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">arnoldi(A, b, 3) and arnoldi_update(A, Q, H)&quot;</span><span class="p">)</span>
<span class="nd">@show</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;H =&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">H</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span>
<span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span>

<span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arnoldi</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arnoldi_update</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">)</span>

<span class="nd">@test</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="p">]</span><span class="w"> </span><span class="o">≈</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="nd">@test</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Q</span><span class="o">&#39;</span><span class="w"> </span><span class="o">≈</span><span class="w"> </span><span class="n">I</span>
<span class="nd">@test</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">≈</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">H</span>
</pre></div>
</div>
</div>
<p>We can use our iterative updates above to provide refined solutions to our problem <span class="math notranslate nohighlight">\(A x = b\)</span> until we hit a target tolerance. In the code below, fill in the missing pieces to see the convergence of GMRES as we try to fit a polynomial to datapoints from the function <span class="math notranslate nohighlight">\(f \left( x \right) = \sin \left( \pi x \right) e^x\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># We want A p = y1</span>
<span class="c"># Again using x1 and y1 to distinguish x1 from the plotting points x below</span>
<span class="n">k_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">65</span>
<span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0243502926634244</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0243502926634244</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.072993121787799</span><span class="p">,</span><span class="w"> </span><span class="mf">0.072993121787799</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.121462819296121</span><span class="p">,</span><span class="w"> </span><span class="mf">0.121462819296121</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.169644420423993</span><span class="p">,</span><span class="w"> </span><span class="mf">0.169644420423993</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.217423643740007</span><span class="p">,</span><span class="w"> </span><span class="mf">0.217423643740007</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.264687162208767</span><span class="p">,</span><span class="w"> </span><span class="mf">0.264687162208767</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.311322871990211</span><span class="p">,</span><span class="w"> </span><span class="mf">0.311322871990211</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.357220158337668</span><span class="p">,</span><span class="w"> </span><span class="mf">0.357220158337668</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.402270157963992</span><span class="p">,</span><span class="w"> </span><span class="mf">0.402270157963992</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.446366017253464</span><span class="p">,</span><span class="w"> </span><span class="mf">0.446366017253464</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.489403145707053</span><span class="p">,</span><span class="w"> </span><span class="mf">0.489403145707053</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.531279464019895</span><span class="p">,</span><span class="w"> </span><span class="mf">0.531279464019895</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.571895646202634</span><span class="p">,</span><span class="w"> </span><span class="mf">0.571895646202634</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.611155355172393</span><span class="p">,</span><span class="w"> </span><span class="mf">0.611155355172393</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.648965471254657</span><span class="p">,</span><span class="w"> </span><span class="mf">0.648965471254657</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.685236313054233</span><span class="p">,</span><span class="w"> </span><span class="mf">0.685236313054233</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.719881850171611</span><span class="p">,</span><span class="w"> </span><span class="mf">0.719881850171611</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.752819907260532</span><span class="p">,</span><span class="w"> </span><span class="mf">0.752819907260532</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.783972358943341</span><span class="p">,</span><span class="w"> </span><span class="mf">0.783972358943341</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.813265315122798</span><span class="p">,</span><span class="w"> </span><span class="mf">0.813265315122798</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.84062929625258</span><span class="p">,</span><span class="w"> </span><span class="mf">0.84062929625258</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.865999398154093</span><span class="p">,</span><span class="w"> </span><span class="mf">0.865999398154093</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.889315445995114</span><span class="p">,</span><span class="w"> </span><span class="mf">0.889315445995114</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.910522137078503</span><span class="p">,</span><span class="w"> </span><span class="mf">0.910522137078503</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.92956917213194</span><span class="p">,</span><span class="w"> </span><span class="mf">0.92956917213194</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.946411374858403</span><span class="p">,</span><span class="w"> </span><span class="mf">0.946411374858403</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.961008799652054</span><span class="p">,</span><span class="w"> </span><span class="mf">0.961008799652054</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.973326827789911</span><span class="p">,</span><span class="w"> </span><span class="mf">0.973326827789911</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.983336253884626</span><span class="p">,</span><span class="w"> </span><span class="mf">0.983336253884626</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.991013371476744</span><span class="p">,</span><span class="w"> </span><span class="mf">0.991013371476744</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.996340116771955</span><span class="p">,</span><span class="w"> </span><span class="mf">0.996340116771955</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.999305041735772</span><span class="p">,</span><span class="w"> </span><span class="mf">0.999305041735772</span><span class="p">]</span>
<span class="n">y1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sin</span><span class="o">.</span><span class="p">(</span><span class="nb">π</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x1</span><span class="p">)</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
<span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vander</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
<span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span>
<span class="n">x_plt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">LinRange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="n">A_plt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vander</span><span class="p">(</span><span class="n">x_plt</span><span class="p">,</span><span class="w"> </span><span class="n">k_max</span><span class="p">)</span>
<span class="n">plt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scatter</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;data&quot;</span><span class="p">)</span>

<span class="c"># Form the initial Krylov subspace</span>
<span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arnoldi</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>

<span class="c"># Solve the least squares problem</span>
<span class="n">β</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">norm</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">e1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">e1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="c">### BEGIN SOLUTION</span>

<span class="c">### END SOLUTION</span>
<span class="n">pn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span>
<span class="n">plt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plot!</span><span class="p">(</span><span class="n">x_plt</span><span class="p">,</span><span class="w"> </span><span class="n">A_plt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pn</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\$</span><span class="s">k = 1</span><span class="se">\$</span><span class="s">&quot;</span><span class="p">)</span>

<span class="c"># And let&#39;s track the norm of the residuals</span>
<span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">k_max</span><span class="p">)</span>
<span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">norm</span><span class="p">(</span><span class="n">y1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pn</span><span class="p">)</span>

<span class="c"># And see how well our solution matches as we increase k</span>
<span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="n">k_max</span>
<span class="w">    </span><span class="c"># Update the Krylov subspace</span>
<span class="w">    </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arnoldi_update</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">)</span>

<span class="w">    </span><span class="c"># Solve the least squares problem</span>
<span class="w">    </span><span class="n">β</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">norm</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="w">    </span><span class="n">e1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">e1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="c">### BEGIN SOLUTION</span>

<span class="w">    </span><span class="c">### END SOLUTION</span>
<span class="w">    </span><span class="n">pn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">plt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plot!</span><span class="p">(</span><span class="n">x_plt</span><span class="p">,</span><span class="w"> </span><span class="n">A_plt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pn</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\$</span><span class="s">k = </span><span class="si">$k</span><span class="se">\$</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="c"># And calculate the latest residual</span>
<span class="w">    </span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">norm</span><span class="p">(</span><span class="n">y1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pn</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">display</span><span class="p">(</span><span class="n">plt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Finally, let’s look at the residual <span class="math notranslate nohighlight">\(b - A x_n\)</span> (in this case <span class="math notranslate nohighlight">\(y - A p_n\)</span>) as the number of vectors in our Krylov subspace increases. We are often interested in the normalized residual, so normalize by <span class="math notranslate nohighlight">\(\left\lvert \left\lvert b \right\rvert \right\rvert\)</span> and plot the residuals on a log-linear scale (log scale in <span class="math notranslate nohighlight">\(y\)</span>, linear scale in <span class="math notranslate nohighlight">\(x\)</span>).</p>
<p>Discuss the convergence. Is there a value <span class="math notranslate nohighlight">\(n &lt; 65\)</span> for which the solution <span class="math notranslate nohighlight">\(x_n\)</span> might be acceptable?</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">### BEGIN SOLUTION</span>

<span class="c">### END SOLUTION</span>
</pre></div>
</div>
</div>
<section id="BEGIN-SOLUTION">
<h3>BEGIN SOLUTION<a class="headerlink" href="#BEGIN-SOLUTION" title="Link to this heading">¶</a></h3>
</section>
<section id="END-SOLUTION">
<h3>END SOLUTION<a class="headerlink" href="#END-SOLUTION" title="Link to this heading">¶</a></h3>
</section>
</section>
<section id="Exploration">
<h2>Exploration<a class="headerlink" href="#Exploration" title="Link to this heading">¶</a></h2>
<p>Select at least one of these exploration problems.</p>
<ol class="arabic simple">
<li><p>GMRES is not the only Krylov subspace method. Select another Krylov subspace method, such as Conjugate Gradient, and compare it with GMRES. Compare the assumptions required for the matrix <span class="math notranslate nohighlight">\(A\)</span> (symmetric, positive definite, etc), defining any relevant terms. Discuss the trade-offs between GMRES and the method you picked. Provide links to at least 2 sources you found (yes, one can be Wikipedia!).</p></li>
<li><p>Select a software package that uses Krylov methods. Provide a link to this package. Summarize which Krylov methods this package uses. Try to determine why the developers picked the Krylov method they did.</p></li>
</ol>
</section>
<section id="Exploration-1">
<h2>Exploration 1<a class="headerlink" href="#Exploration-1" title="Link to this heading">¶</a></h2>
<section id="id1">
<h3>BEGIN SOLUTION<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
</section>
<section id="id2">
<h3>END SOLUTION<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h3>
</section>
</section>
<section id="Exploration-2">
<h2>Exploration 2<a class="headerlink" href="#Exploration-2" title="Link to this heading">¶</a></h2>
<section id="id3">
<h3>BEGIN SOLUTION<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
</section>
<section id="id4">
<h3>END SOLUTION<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h3>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">CSCI 3656</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">Course Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ungrading.html">Ungrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks.html">Class Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quizzes.html">Quizzes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../homework.html">Homework</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../homework.html">Homework</a><ul>
      <li>Previous: <a href="2025-10-03-Orthogonal-Polynomials-student.html" title="previous chapter">2025-10-03 Orthogonal Polynomials</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Jeremy L Thompson.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/homework/2025-10-17-Krylov-student.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>